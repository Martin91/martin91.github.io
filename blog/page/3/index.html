
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Martin</title>
	<meta name="author" content="Martin">

	
	<meta name="description" content="此文翻译自Reading Rails &ndash; Handling Exceptions，限于本人水平，翻译不当之处，敬请指教！ 我们今天开始会读一些Rails的源码。我们有双重的目的，先通过学习（Rails）如何处理异常，再扩展到整个Ruby中基础知识的学习。 Read on &rarr &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Martin" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="/javascripts/jquery-1.11.1.min.js"></script>
	
</head>


<body>
	<header id="header" class="inner"><h1><a href="/">Martin</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:Martin91.github.io">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
    
	</div>
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:Martin91.github.io">
	</form>
</nav>

</header>
	
		
	
	<div id="content" class="inner">


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/articles/2014/03/05/jie-du-rails-chu-li-yi-chang/">
		
			解读Rails - 处理异常</a>
	</h2>
	<div class="entry-content">
		<p>此文翻译自<a href="http://monkeyandcrow.com/blog/reading_rails_handling_exceptions/">Reading Rails &ndash; Handling Exceptions</a>，限于本人水平，翻译不当之处，敬请指教！</p>

<p>我们今天开始会读一些Rails的源码。我们有双重的目的，先通过学习（Rails）如何处理异常，再扩展到整个Ruby中基础知识的学习。</p>


		
		<a href="/blog/articles/2014/03/05/jie-du-rails-chu-li-yi-chang/" class="more-link">Read on &rarr;</a>
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-03-05T13:53:09+08:00" pubdate data-updated="true">Mar 5<span>th</span>, 2014</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/rails/'>Rails</a>, <a class='category' href='/blog/categories/ruby/'>Ruby</a>, <a class='category' href='/blog/categories/chu-li-yi-chang/'>处理异常</a>, <a class='category' href='/blog/categories/fan-yi/'>翻译</a>, <a class='category' href='/blog/categories/jie-du-rails/'>解读Rails</a>


</div>
	
	<div class="comments"><a href="/blog/articles/2014/03/05/jie-du-rails-chu-li-yi-chang/#disqus_thread">Comments</a></div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/articles/2014/03/03/jie-du-rails-gua-pei-qi-mo-shi/">
		
			解读Rails - 适配器模式</a>
	</h2>
	<div class="entry-content">
		<p>本文翻译自<a href="http://monkeyandcrow.com/blog/reading_rails_the_adapter_pattern/?utm_source=rubyweekly&amp;utm_medium=email">Reading Rails &ndash; The Adapter Pattern</a>，限于本人水平有限，翻译不当之处，敬请指教！</p>

<p>今天我们暂时先放下具体的代码片段，我们将要对Rails中所实现的一个比较常见的设计模式进行一番探索，这个模式就是<a href="http://en.wikipedia.org/wiki/Adapter_pattern">适配器模式（Adapter Pattern）</a>。从一定的意义上来说，这次的探索并不全面，但是我希望能够突出一些实际的例子。</p>


		
		<a href="/blog/articles/2014/03/03/jie-du-rails-gua-pei-qi-mo-shi/" class="more-link">Read on &rarr;</a>
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-03-03T13:40:03+08:00" pubdate data-updated="true">Mar 3<span>rd</span>, 2014</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/rails/'>rails</a>, <a class='category' href='/blog/categories/ruby/'>ruby</a>, <a class='category' href='/blog/categories/fan-yi/'>翻译</a>, <a class='category' href='/blog/categories/jie-du-rails/'>解读Rails</a>, <a class='category' href='/blog/categories/she-ji-mo-shi/'>设计模式</a>, <a class='category' href='/blog/categories/gua-pei-qi-mo-shi/'>适配器模式</a>


</div>
	
	<div class="comments"><a href="/blog/articles/2014/03/03/jie-du-rails-gua-pei-qi-mo-shi/#disqus_thread">Comments</a></div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/articles/2014/03/02/jie-du-rails-xi-lie-fan-yi/">
		
			解读Rails(系列翻译)</a>
	</h2>
	<div class="entry-content">
		<p>解读Rails系列文章原文来自<a href="http://monkeyandcrow.com/series/reading_rails/">Reading Rails</a>，我将尽我所能完成此系列所有文章的翻译。以下部分为原文系列对应翻译：</p>

<p>在我们的工作中，我们的大部分时间都是在使用各种各样的工具，但是你知不知道它们是如何工作的呢？</p>

<p>在这个系列里，我们通过阅读<a href="http://rubyonrails.org/">Ruby on Rails</a>的源码去探索其内部的工作机制。我们将不仅仅只是学到与Rails有关的知识，我们也将见识到Ruby里边一些有趣的功能，以及一些有用的新技巧。</p>

<ul>
<li><a href="/blog/2014/03/03/jie-du-rails-gua-pei-qi-mo-shi/">解读Rails &ndash; 适配器模式</a></li>
<li><a href="">解读Rails &ndash; 错误和验证器</a></li>
<li><a href="">解读Rails &ndash; 验证机制是如何配置的</a></li>
<li><a href="">解读Rails &ndash; Concern</a></li>
<li><a href="">解读Rails &ndash; 更多的Migrations</a></li>
<li><a href="">解读Rails &ndash; Migrations</a></li>
<li><a href="/blog/2014/03/12/shu-xing-fang-fa/">解读Rails &ndash; 属性方法(Attribute Methods)</a></li>
<li><a href="/blog/2014/03/07/zhui-zong-bian-geng/">解读Rails &ndash; 跟踪model中属性（值）的变更</a></li>
<li><a href="/blog/2014/03/05/jie-du-rails-chu-li-yi-chang/">解读Rails &ndash; 处理异常</a></li>
</ul>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-03-02T13:40:07+08:00" pubdate data-updated="true">Mar 2<span>nd</span>, 2014</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/rails/'>Rails</a>, <a class='category' href='/blog/categories/fan-yi/'>翻译</a>, <a class='category' href='/blog/categories/jie-du-rails/'>解读Rails</a>


</div>
	
	<div class="comments"><a href="/blog/articles/2014/03/02/jie-du-rails-xi-lie-fan-yi/#disqus_thread">Comments</a></div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/articles/2014/03/01/zai-rubyzhong-shi-yong-websocket/">
		
			在Ruby中使用WebSocket</a>
	</h2>
	<div class="entry-content">
		<p><strong>声明</strong>: 此文翻译自<a href="http://www.troikatech.com/blog/2014/02/26/websocket-webmachine/?utm_source=rubyweekly&amp;utm_medium=email">WebSockets in Ruby</a>， 限于本人才疏学浅，其中有翻译不当之处，敬请指出，感激不尽！</p>

<p>在我的主要工作中，需要构建一个一直占用相当大CPU时间片的数据系统。这个任务主要用于在地理编码以及local reference system(本地地理系统？)之间进行编码以及解码。举个例子，这个工作将帮助我们在系统中标记一条对应于街道上某个地点的记录，并且可以知道本地地理位置所对应的坐标。</p>


		
		<a href="/blog/articles/2014/03/01/zai-rubyzhong-shi-yong-websocket/" class="more-link">Read on &rarr;</a>
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-03-01T21:31:03+08:00" pubdate data-updated="true">Mar 1<span>st</span>, 2014</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/ruby/'>Ruby</a>, <a class='category' href='/blog/categories/websocket/'>WebSocket</a>, <a class='category' href='/blog/categories/fan-yi/'>翻译</a>


</div>
	
	<div class="comments"><a href="/blog/articles/2014/03/01/zai-rubyzhong-shi-yong-websocket/#disqus_thread">Comments</a></div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/articles/2014/01/12/diy-an-interesting-timer-through-terminal-notifier-and-crontab-under-mac-os-x/">
		
			DIY an Interesting Timer Through Terminal-notifier and Crontab Under Mac OS X</a>
	</h2>
	<div class="entry-content">
		<p>Today I will show you how to DIY an intersting notifier automatically running per hour under the Mac OS X 10.8 and higher, all we need are a terminal-notifier and the system built-in command line program named <code>crontab</code>.</p>


		
		<a href="/blog/articles/2014/01/12/diy-an-interesting-timer-through-terminal-notifier-and-crontab-under-mac-os-x/" class="more-link">Read on &rarr;</a>
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-01-12T15:51:00+08:00" pubdate data-updated="true">Jan 12<span>th</span>, 2014</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/tools/'>tools</a>


</div>
	
	<div class="comments"><a href="/blog/articles/2014/01/12/diy-an-interesting-timer-through-terminal-notifier-and-crontab-under-mac-os-x/#disqus_thread">Comments</a></div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/articles/2013/09/07/split-logs-automatically-every-day/">
		
			Split Logs Automatically Every Day</a>
	</h2>
	<div class="entry-content">
		<p><strong>Related resource(s):</strong></p>

<p>&ldquo;linuxcommand: logrotate&rdquo;:<a href="http://linuxcommand.org/man_pages/logrotate8.html">http://linuxcommand.org/man_pages/logrotate8.html</a><br>
<strong>logrotate</strong>  is  designed to ease administration of systems that generate large numbers of log files. Normally, logrotate is run as a daily cron job.</p>

<p><strong>Some important knowledges:</strong></p>

<ul>
<li>Any number of config files may be given. Later config files may override the options given in earlier files, so the order in  which  the logrotate config files are listed in is important.  Normally, <strong>a single config file which includes any other config files which are  needed  should  be used</strong>.  If a directory is  given, every file in that directory is used as a config file.</li>
<li><strong>Default config file:</strong> /etc/logrotate.conf. You can include other config files within it using <strong>include</strong> directive.</li>
</ul>



		
		<a href="/blog/articles/2013/09/07/split-logs-automatically-every-day/" class="more-link">Read on &rarr;</a>
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-09-07T01:11:00+08:00" pubdate data-updated="true">Sep 7<span>th</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/support/'>support</a>, <a class='category' href='/blog/categories/tips/'>tips</a>


</div>
	
	<div class="comments"><a href="/blog/articles/2013/09/07/split-logs-automatically-every-day/#disqus_thread">Comments</a></div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/articles/2013/09/07/backup-database-and-other-attachments-in-ror/">
		
			Backup Database and Other Attachments in ROR</a>
	</h2>
	<div class="entry-content">
		<h2>Related Resources</h2>

<ol>
<li><strong>rsync</strong>:<a href="http://rsync.samba.org/">http://rsync.samba.org/</a></li>
<li><strong>Crontab</strong>:<a href="http://unixhelp.ed.ac.uk/CGI/man-cgi?crontab+5">http://unixhelp.ed.ac.uk/CGI/man-cgi?crontab+5</a></li>
<li><strong>&ldquo;Linux Crontab 定时任务 命令详解&rdquo;</strong>:<a href="http://blog.csdn.net/tianlesoftware/article/details/5315039">http://blog.csdn.net/tianlesoftware/article/details/5315039</a></li>
<li><strong>[rubygem]&ldquo;backup&rdquo;</strong>:<a href="https://github.com/meskyanichi/backup">https://github.com/meskyanichi/backup</a></li>
<li><strong>[rubygem]&ldquo;whenever&rdquo;</strong>:<a href="https://github.com/javan/whenever">https://github.com/javan/whenever</a></li>
</ol>


<h2>Automatically backup on the remote server:</h2>

<p>Let&rsquo;s firstly assumpt:</p>

<ol>
<li>You have a site named &ldquo;<strong>example.com</strong>&rdquo;;</li>
<li>You can login to it through a username &ldquo;<strong>deploy</strong>&rdquo;, and its password is &ldquo;<strong>password</strong>&rdquo;;</li>
<li>You located the contents of your site in <code>/var/www/example/</code>;</li>
<li>Your database server is <strong>Mysql</strong>, and the database for your site is <strong>example_production</strong>.</li>
</ol>



		
		<a href="/blog/articles/2013/09/07/backup-database-and-other-attachments-in-ror/" class="more-link">Read on &rarr;</a>
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-09-07T00:26:00+08:00" pubdate data-updated="true">Sep 7<span>th</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/backup/'>backup</a>, <a class='category' href='/blog/categories/tips/'>tips</a>


</div>
	
	<div class="comments"><a href="/blog/articles/2013/09/07/backup-database-and-other-attachments-in-ror/#disqus_thread">Comments</a></div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/articles/2013/08/29/write-css-codes-distinct-from-different-pages/">
		
			Write Css Codes Distinct From Different Pages</a>
	</h2>
	<div class="entry-content">
		<p>In rails, there is normally a view corresponding to an action. So if you want to do some special styles based on different pages, you can render controller name and action name in your layout file like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;body</span> <span class="na">class=</span><span class="s">&quot;#{controller_name} #{action_name}&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="c">&lt;!-- Render something --&gt;</span>
</span><span class='line'><span class="nt">&lt;/body&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s assumpt that your current page controller is <code>ProductsController</code>, and your action is <code>index</code>, then you can write your style codes like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='scss'><span class='line'><span class="nc">.products.index</span> <span class="p">{</span>
</span><span class='line'>  <span class="cm">/* some styles */</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-08-29T15:32:00+08:00" pubdate data-updated="true">Aug 29<span>th</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/tips/'>tips</a>


</div>
	
	<div class="comments"><a href="/blog/articles/2013/08/29/write-css-codes-distinct-from-different-pages/#disqus_thread">Comments</a></div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/articles/2013/08/09/failed-to-stop-or-restart-nginx-server-through-serevice-command/">
		
			Failed to Stop or Restart Nginx Server Through Serevice Command</a>
	</h2>
	<div class="entry-content">
		<p>Many people are accustomed to start a Nginx web server through init scripts and then they can control the state of the server through <code>service</code> command, such as <code>sudo service nginx restart</code>. But sometimes unobvious config error makes the scripts failed to work. Here I will show an error related to <code>pid</code> directive in the config file of nginx, which defaultly located at <code>/opt/nginx/conf/nginx.conf</code>. <br>
As ignored by many people, some init scripts assump there is a pid file of nginx located at <code>/var/run/nginx.pid</code>, but in the fact, the default pid file for nginx is <code>/opt/nginx/logs/nginx.pid</code>. Because the scripts can&rsquo;t get the correct pid or even get nothing, they failed to stop the nginx process, some tasks dependent on it will be failed too, for example, you are not able to restart the server.<br></p>

<p>To resolve this problem, you need to:</p>

<ol>
<li><strong>Force terminating your server through:</strong></li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>sudo service nginx destroy
</span></code></pre></td></tr></table></div></figure>


<ol>
<li><strong>Open your nginx config file to edit:</strong></li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>sudo vim /opt/nginx/conf/nginx.conf
</span></code></pre></td></tr></table></div></figure>


<ol>
<li><strong>Specify the path of your pid file:</strong></li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c"># /opt/nginx/conf/nginx.conf</span>
</span><span class='line'>pid /var/run/nginx.pid
</span></code></pre></td></tr></table></div></figure>


<ol>
<li><strong>After saving your change, start your server now:</strong></li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>sudo service nginx start
</span></code></pre></td></tr></table></div></figure>


<ol>
<li><strong>To confirm that your pid config has taken effect, you can cat your pid file and/or try to restart your server through <code>service</code> command:</strong></li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>cat /var/run/nginx.pid
</span><span class='line'><span class="nv">$ </span>sudo service nginx restart
</span></code></pre></td></tr></table></div></figure>


<p>As expected, you will see the screen out <strong>&ldquo;OK&rdquo;</strong> for your operations.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-08-09T11:39:00+08:00" pubdate data-updated="true">Aug 9<span>th</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/nginx/'>Nginx</a>


</div>
	
	<div class="comments"><a href="/blog/articles/2013/08/09/failed-to-stop-or-restart-nginx-server-through-serevice-command/#disqus_thread">Comments</a></div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/articles/2013/07/25/export-slash-import-to-slash-from-a-csv-file/">
		
			Export/import Datas To/from a Csv File</a>
	</h2>
	<div class="entry-content">
		<p>今天需要给客户的网站做支持产品数据导出并且更新的功能，所以就涉及到了数据的导入导出了。在经过一番对比之下，果断使用<code>csv</code>格式文件作为数据导入导出的载体。<br></p>

<h4>导出csv文件</h4>

<p>与csv文件主要相关的类是<code>CSV</code>,此类在ruby的标准库中被定义，所以只要在代码开头引入相关文件即可:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;csv&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>接着需要创建csv文件，并在其中写入数据:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">CSV</span><span class="o">.</span><span class="n">open</span> <span class="s2">&quot;path/to/csv/file&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">,</span> <span class="ss">:col_sep</span> <span class="o">=&gt;</span> <span class="s1">&#39;|&#39;</span> <span class="k">do</span> <span class="o">|</span><span class="n">csv</span><span class="o">|</span>
</span><span class='line'>  <span class="n">csv</span> <span class="o">&lt;&lt;</span> <span class="o">[</span><span class="s2">&quot;one&quot;</span><span class="p">,</span> <span class="s2">&quot;row&quot;</span><span class="p">,</span> <span class="s2">&quot;of&quot;</span><span class="p">,</span> <span class="s2">&quot;contents&quot;</span><span class="o">]</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong> 这里有几个细节值得一提：</strong><br>
1. <code>open</code>方法是用于对CSV文件进行写操作的主要接口,对CSV文件进行写操作都应该使用此方法;<br>
2. <code>&lt;&lt;</code> 操作符支持将<strong>字符串数组</strong>写入到csv文件,一个数组为一行，数组中的一个字符串为一个单元(field);<br>
3. <code>open</code>方法的第三个参数是一个哈希，用于为打开的文件指定初始化赋值，具体可用的option以及其值可参考<code>new</code>方法的说明:<a href="http://www.ruby-doc.org/stdlib-1.9.3/libdoc/csv/rdoc/CSV.html#method-c-new">http://www.ruby-doc.org/stdlib-1.9.3/libdoc/csv/rdoc/CSV.html#method-c-new</a> <br>
4. <code>:col_sep</code>用于指定文件中每一行中的每个单元之间的分隔符，当通过字符串数组想文件中添加新行的时候，CSV将会在数组元素也就是每一行的单元之间插入指定的分隔符，分隔符需要尽量避开已经在待导出数据中存在的字符，以免后续导入的时候发生歧义。</p>

<h4>导入csv文件</h4>

<p>导入csv除了需要用到相关的类<code>CSV</code>，还可能用到的类是<code>CSV::Row</code>，前者提供打开文件以及将文件按行分隔的方法<code>foreach</code>，foreach将分隔后的行逐行分配到CSV::Row的实例中，通过调用CSV::Row的实例方法<code>field</code>可对每个单元进行读取。<br>
假设我有这样一个csv文件：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">id</span>      <span class="o">|</span>     <span class="n">value</span>
</span><span class='line'><span class="mi">1234</span>      <span class="o">|</span>        <span class="n">hello</span>
</span><span class='line'><span class="mi">2345</span>      <span class="o">|</span>        <span class="n">world</span>
</span></code></pre></td></tr></table></div></figure>


<p>则相关的代码如下：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">CSV</span><span class="o">.</span><span class="n">foreach</span><span class="p">(</span><span class="s1">&#39;path/to/file&#39;</span><span class="p">),</span> <span class="ss">:col_sep</span> <span class="o">=&gt;</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="ss">:headers</span> <span class="o">=&gt;</span> <span class="ss">:first_row</span> <span class="k">do</span> <span class="o">|</span><span class="n">row</span><span class="o">|</span>
</span><span class='line'>  <span class="c1"># use datas of each row</span>
</span><span class='line'>  <span class="nb">id</span>      <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">field</span> <span class="s1">&#39;id&#39;</span>
</span><span class='line'>  <span class="n">value</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">field</span> <span class="s1">&#39;value&#39;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong> 同样这里也有几个细节需要注意:</strong><br>
1. <code>foreach</code>是CSV类中用于读取文件的标准方法；<br>
2. 通过指定<code>:col_sep =&gt; '|'</code>可使CSV按照指定的分隔符分隔好文件内容，方便后面<code>field</code>方法的调用；<br>
3. 指定<code>:headers =&gt; :first_row</code>可使CSV将第一行视为文件的headers，并且结合<code>:col_sep</code>的设定可以将headers进行分割，这两个是<code>field</code>方法的基础。</p>

<h5>Related links:</h5>

<p><a href="http://www.ruby-doc.org/stdlib-1.9.3/libdoc/csv/rdoc/CSV.html">http://www.ruby-doc.org/stdlib-1.9.3/libdoc/csv/rdoc/CSV.html</a> <br>
<a href="http://www.ruby-doc.org/stdlib-1.9.3/libdoc/csv/rdoc/CSV/Row.html">http://www.ruby-doc.org/stdlib-1.9.3/libdoc/csv/rdoc/CSV/Row.html</a></p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-07-25T22:19:00+08:00" pubdate data-updated="true">Jul 25<span>th</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/csv/'>csv</a>, <a class='category' href='/blog/categories/ruby/'>ruby</a>


</div>
	
	<div class="comments"><a href="/blog/articles/2013/07/25/export-slash-import-to-slash-from-a-csv-file/#disqus_thread">Comments</a></div>
	
</div>
</article>

<nav id="pagenavi">
    
        <a href="/blog/page/2/" class="prev">Prev</a>
    
    
        <a href="/blog/page/4/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
	<footer id="footer" class="inner">Copyright &copy; 2016

    Martin

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'martin-blog';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//go.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>




<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F6d4498d8e2d7328fffdb1539f0589a61' type='text/javascript'%3E%3C/script%3E"));
</script>
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId      : '781315158664022',
      xfbml      : true,
      version    : 'v2.4'
    });
  };

  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "//connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));
</script>

</body>
</html>
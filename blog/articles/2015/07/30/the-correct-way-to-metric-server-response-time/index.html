
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Apdex——衡量服务器性能的标准 - Martin</title>
	<meta name="author" content="Martin">

	
	<meta name="description" content="日常工作中，我们总是习惯于通过量化的标准去衡量我们对事物的评价，比如美食点评的星级、酒店的星级、每个个人的信用评分等等。而作为一个 Web 工程师，我们也总是在意于我们网站的性能，因为网站的性能会最直接地影响用户的体验。今天要介绍的就是一种同样能够帮助工程师对应用性能进行量化评估的标准 —— &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Martin" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="/javascripts/jquery-1.11.1.min.js"></script>
	
</head>


<body>
	<header id="header" class="inner"><h1><a href="/">Martin</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:Martin91.github.io">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
    
	</div>
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:Martin91.github.io">
	</form>
</nav>

</header>
	
		
	
	<div id="content" class="inner"><article class="post">
	<h2 class="title">Apdex——衡量服务器性能的标准</h2>
	<div class="entry-content"><p>日常工作中，我们总是习惯于通过量化的标准去衡量我们对事物的评价，比如美食点评的星级、酒店的星级、每个个人的信用评分等等。而作为一个 Web 工程师，我们也总是在意于我们网站的性能，因为网站的性能会最直接地影响用户的体验。今天要介绍的就是一种同样能够帮助工程师对应用性能进行量化评估的标准 —— Apdex 。</p>

<!-- MORE -->


<p>Apdex 全称是 Application Performance Index，是由 Apdex 联盟开放的用于评估应用性能的工业标准。Apdex 联盟起源于 2004 年，由 <a href="http://apdex.org/bios.html">Peter Sevcik</a>发起。Apdex 标准从用户的角度出发，将对应用响应时间的表现，转为用户对于应用性能的可量化为范围为 0-1 的满意度评价。</p>

<h3>术语</h3>

<p>Apdex 定义了应用响应时间的最优门槛为T，另外根据应用响应时间结合 T 定义了三种不同的性能表现：</p>

<ul>
<li><strong>Satisfied（满意）</strong>：应用响应时间低于或等于 T（T 由性能评估人员根据预期性能要求确定），比如 T 为 1.5s，则一个耗时 1s 的响应结果则可以认为是 satisfied 的。</li>
<li><strong>Tolerating（可容忍）</strong>：应用响应时间大于 T，但同时小于或等于 4T。假设应用设定的 T 值为 1s，则 4 * 1 = 4 秒极为应用响应时间的容忍上限。</li>
<li><strong>Frustrated（烦躁期）</strong>：应用响应时间大于 4T。</li>
</ul>


<h3>公式</h3>

<p><code>Apdex<sub>t</sub> = (Satisfied Count + Tolerating Count / 2) / Total Samples</code></p>

<p>其中 <code>Satisfied Count</code> 就是指定采样时间内响应时间满足 <code>Satisfied</code> 要求的应用响应次数；而 <code>Tolerating Count</code> 就是指定采样时间内响应时间满足 <code>Tolerating</code> 要求的应用响应次数；最后的 <code>Total Samples</code> 就是总的采样次数总数。从公式可以看出，应用的 Apdex 得分与采样持续时间无关，与目标响应时间 T 相关（在采用总数固定的情况下，T 通过影响 <code>Satisfied Count</code>以及 <code>Tolerating Count</code>的值间接影响最终的得分）。</p>

<p>举例来说，假设你的应用期待的响应时间能够在 1000 ms 内，在 100 次采样中，有 50 次应用响应时间低于 1000 ms，30 次应用响应时间处于 1000 ms 到 4000 ms（ 4 * 1000ms） 之间，剩下 20 次响应时间长于 4000 ms，那么，该应用在 T = 1000ms 的情况下的 Apdex 值为：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="p">(</span><span class="mi">50</span> <span class="o">+</span> <span class="mi">30</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span> <span class="o">=</span> <span class="mi">0</span><span class="o">.</span><span class="mi">65</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Apdex 与 New Relic</h3>

<p>在 New Relic 的 APM（Application Performance Management）功能中，就提供了各个维度的 Apdex 统计结果，比如 Server Apdex(服务器性能评分)以及 Browser Apdex(终端用户性能体验评分)，如图：
<img src="http://7xj84e.com1.z0.glb.clouddn.com/blog/apdex%20overview.png" alt="Apdex 统计报表(T=0.5s)" /></p>

<p>其中可以看到应用服务器在 <code>T=0.5s</code> 的情况下得到的 Apdex 分数为 0.76，而 Browser（Browser 更多的是静态文件加载） 在 <code>T=7s</code>的情况下得到的 Apdex 分数为 0.94。结合两者可以判断，目前应用到达终端用户性能表现比较优秀（0.94，比较接近最大值 1），但是其中影响总体性能的瓶颈则在于服务器性能（仅仅只有 0.76 分），通过这样的数据，我们就能知道下一步性能优化的方向了——服务器端性能优化。</p>

<p>实际上，上面展示的只是 New Relic 的一种粒度比较粗的针对整个应用的 Apdex 报表，New Relic 同样提供了很多细粒度的 Apdex 数据，比如下面展示的针对具体的请求入口的 Apdex 报表：
<img src="http://7xj84e.com1.z0.glb.clouddn.com/blog/detailed_apdex.png" alt="具体请求入口的 Apdex" />
这样，通过逐步的细化，我们就可以进一步定位性能瓶颈，通过不断优化 Apdex 评分低的入口逐步提升应用整体性能体验。</p>

<h3>Apdex 与 T 值</h3>

<p>从公式中其实可以非常明显地看出来，T 值的选择对于最终的 Apdex 值也会有直接影响，越大的 T 值理论上来说会有更大的 Apdex 得分。比如我们可以在 New Relic 中将应用的 Apdex T 值改为 1s，以下是设定过程中看到的原来的值是 0.5s：
<img src="http://7xj84e.com1.z0.glb.clouddn.com/blog/apdex%20setting.png" alt="T 值设定" />
而改为 1s 后，跟上面同样的采样数据得到的新的平均 Apdex 值则高于原来的 0.76。
所以，在对应用性能进行评估的时候，首先需要确保结合应用具体情况设定一个相对合理的 T 值，太大的 T 值会导致过于乐观的 Apdex 值，但是太小的 T 值又会造成过于严苛的性能要求，最终可能导致过度的性能优化。
所以，总而言之，抛弃 T 值谈 Apdex 得分，都是耍流氓！</p>

<h3>Apdex 值一定要做到 1 吗？</h3>

<p>Apdex 公式计算能够得到的最大值就是 1，表示应用“可能”能够令所有用户对应用性能感到满意。但是， Apdex = 1 可以只是一个不断优化的方向，却不一定是要成为优化的目标，具体根据项目实际情况确定，毕竟，优化本身也需要成本投入，不需要为了极致的性能而投入过多的成本。</p>

<h3>参考资料以及推荐链接</h3>

<ol>
<li><a href="https://en.wikipedia.org/wiki/Apdex">Wikipedia: Apdex</a></li>
<li><a href="http://www.apdex.org/">Apdex 官网</a></li>
<li><a href="https://docs.newrelic.com/docs/apm/new-relic-apm/apdex/apdex-measuring-user-satisfaction#what-is">Apdex: Measuring user satisfaction</a></li>
<li><a href="https://docs.newrelic.com/docs/apm/new-relic-apm/apdex/change-your-apdex-settings">New Relic: Change your Apdex settings</a></li>
<li><a href="https://docs.newrelic.com/docs/apm/new-relic-apm/apdex/view-your-apdex-score">New Relic: View your Apdex score</a></li>
</ol>

</div>


<div class="meta">
	<div class="date">








  


<time datetime="2015-07-30T12:12:07+08:00" pubdate data-updated="true">Jul 30<span>th</span>, 2015</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/apdex-server-performance-fu-wu-qi-xing-neng/'>Apdex server performance 服务器 性能</a>


</div>
	
	<div class="comments"><a href="#disqus_thread">Comments</a></div>
	
</div>
</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
		
		
		<a class="addthis_button_tweet"></a>
		
		
		<a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
		
		
	</div>
	
</div>



<section id="comment">
    <h2 class="title">Comments</h2>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>
</div>
	<footer id="footer" class="inner">Copyright &copy; 2016

    Martin

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'martin-blog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://Martin91.github.io/blog/articles/2015/07/30/the-correct-way-to-metric-server-response-time/';
        var disqus_url = 'http://Martin91.github.io/blog/articles/2015/07/30/the-correct-way-to-metric-server-response-time/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//go.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>




<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F6d4498d8e2d7328fffdb1539f0589a61' type='text/javascript'%3E%3C/script%3E"));
</script>
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId      : '781315158664022',
      xfbml      : true,
      version    : 'v2.4'
    });
  };

  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "//connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));
</script>

</body>
</html>
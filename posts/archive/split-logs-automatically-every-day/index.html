<!doctype html><html lang=en><head><meta charset=utf-8><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><meta name=description content><title>Split logs automatically every day</title><style>.hljs-comment,.hljs-quote{color:#8e908c}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#c82829}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5871f}.hljs-attribute{color:#eab700}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#718c00}.hljs-section,.hljs-title{color:#4271ae}.hljs-keyword,.hljs-selector-tag{color:#8959a8}.hljs{display:block;overflow-x:auto;background:#fff;color:#4d4d4c;padding:.5em}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><link rel=canonical href=https://blog.hackerpie.com/posts/archive/split-logs-automatically-every-day/><style>*{border:0;font:inherit;font-size:100%;vertical-align:baseline;margin:0;padding:0;color:#000;text-decoration-skip:ink}body{font-family:open sans,myriad pro,Myriad,sans-serif;font-size:17px;line-height:160%;color:#1d1313;max-width:1000px;margin:auto}p{margin:20px 0;letter-spacing:1pt}a img{border:none}img{margin:10px auto;max-width:100%;display:block}.left-justify{float:left}.right-justify{float:right}pre,code{font:12px Consolas,liberation mono,Menlo,Courier,monospace;background-color:#f7f7f7}code{font-size:12px;padding:4px}pre{margin-top:0;margin-bottom:16px;word-wrap:normal;padding:16px;overflow:auto;font-size:85%;line-height:1.45}pre>code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:0 0;border:0}pre code{display:inline;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}pre code::before,pre code::after{content:normal}em,q,em,dfn{font-style:italic}.sans,html .gist .gist-file .gist-meta{font-family:open sans,myriad pro,Myriad,sans-serif}.mono,pre,code,tt,p code,li code{font-family:Menlo,Monaco,andale mono,lucida console,courier new,monospace}.section-title{font-family:fangsong,old standard tt,serif}.heading,.serif,h1,h2,h3{font-family:old standard tt,serif}strong{font-weight:600}q:before{content:"\201C"}q:after{content:"\201D"}del,s{text-decoration:line-through}blockquote{font-family:old standard tt,serif;text-align:center;padding:50px}blockquote p{display:inline-block;font-style:italic}blockquote:before,blockquote:after{font-family:old standard tt,serif;content:'\201C';font-size:35px;color:#403c3b}blockquote:after{content:'\201D'}hr{width:40%;height:1px;background:#403c3b;margin:25px auto}h1{font-size:35px}h2{font-size:28px}h3{font-size:22px;margin-top:18px}h1 a,h2 a,h3 a{text-decoration:none}h1,h2{margin-top:28px}#sub-header,.date{color:#403c3b;font-size:13px}#sub-header{margin:0 4px}#nav h1 a{font-size:35px;color:#1d1313;line-height:120%}.posts_listing a,#nav a{text-decoration:none}li{margin-left:20px}ul li{margin-left:5px}ul li{list-style-type:none}ul li:before{content:"\00BB \0020"}#nav ul li:before,.posts_listing li:before{content:'';margin-right:0}#content{text-align:left;width:100%;font-size:15px;padding:60px 0 80px}#content h1,#content h2{margin-bottom:5px}#content h2{font-size:25px}#content .entry-content{margin-top:15px}#content .date{margin-left:3px}#content h1{font-size:30px}.highlight{margin:10px 0}.posts_listing{margin:0 0 50px}.posts_listing li{margin:0 0 25px 15px}.posts_listing li a:hover,#nav a:hover{text-decoration:underline}#nav{text-align:center;position:static;margin-top:60px}#nav ul{display:table;margin:8px auto 0}#nav li{list-style-type:none;display:table-cell;font-size:15px;padding:0 20px}#links{display:flex;justify-content:space-between;margin:50px 0 0}#links :nth-child(1){margin-right:.5em}#links :nth-child(2){margin-left:.5em}#not-found{text-align:center}#not-found a{font-family:old standard tt,serif;font-size:200px;text-decoration:none;display:inline-block;padding-top:225px}@media(max-width:750px){body{padding-left:20px;padding-right:20px}#nav h1 a{font-size:28px}#nav li{font-size:13px;padding:0 15px}#content{margin-top:0;padding-top:50px;font-size:14px}#content h1{font-size:25px}#content h2{font-size:22px}.posts_listing li div{font-size:12px}}@media(max-width:400px){body{padding-left:20px;padding-right:20px}#nav h1 a{font-size:22px}#nav li{font-size:12px;padding:0 10px}#content{margin-top:0;padding-top:20px;font-size:12px}#content h1{font-size:20px}#content h2{font-size:18px}.posts_listing li div{font-size:12px}}@media(prefers-color-scheme:dark){*,#nav h1 a{color:#fdfdfd}body{background:#121212}pre,code{background-color:#262626}#sub-header,.date{color:#bababa}hr{background:#ebebeb}}</style></head><body><section id=nav><h1 id=site-title><a href=https://blog.hackerpie.com/>老码之途</a></h1><h3>在“码”路上步步为营</h3><ul></ul></section><section id=content><h1 class=section-title>Split logs automatically every day</h1><div id=sub-header>07/Sep/2013 · 2 minute read</div><div class=entry-content><p><strong>Related resource(s):</strong></p><p>&ldquo;linuxcommand: logrotate&rdquo;:http://linuxcommand.org/man_pages/logrotate8.html
<strong>logrotate</strong> is designed to ease administration of systems that generate large numbers of log files. Normally, logrotate is run as a daily cron job.</p><p><strong>Some important knowledges:</strong></p><ul><li>Any number of config files may be given. Later config files may override the options given in earlier files, so the order in which the logrotate config files are listed in is important. Normally, <strong>a single config file which includes any other config files which are needed should be used</strong>. If a directory is given, every file in that directory is used as a config file.</li><li><strong>Default config file:</strong> /etc/logrotate.conf. You can include other config files within it using <strong>include</strong> directive.</li></ul><h2 id=assumption>Assumption</h2><ol><li>Your site is <code>example.com</code></li><li>The site is located in <code>/var/www/example/</code></li><li>Your site is deployed by Capistrano, so you can find your logs in <code>/var/www/example/shared/log/</code></li><li>Your static contents server is <strong>Nginx</strong>, and its logs are located in <code>/var/www/example/shared/log/</code> and their names start with <code>nginx_</code></li></ol><h2 id=how-to-do>How to do</h2><h3 id=1-login-your-server>1. Login your server</h3><h3 id=2-make-sure-that-include-etclogrotated-is-existed-in-default-config-file-and-not-commented>2. Make sure that &ldquo;include /etc/logrotate.d&rdquo; is existed in default config file and not commented:</h3><p>You should be able to find the directive shown below, if not, append it manully.</p><h3 id=3create-new-logrotate-config-files-for-your-sites-logs>3.Create new logrotate config files for your site&rsquo;s logs</h3><p><strong>A. Create new rotate config file for application log:</strong></p><p>Type following contents, and save.</p><p><strong>B. Create new rotate config file for server log:</strong></p><p>Type following contents, and save.</p><p><strong>Attention:</strong>
<strong>/var/run/nginx.pid</strong> is your nginx pid file path, but someone may use default nginx pid path(<strong>/opt/nginx/logs/nginx.pid</strong>). You have two solutions to solve this conflict:</p><blockquote><p>A. Change <code>/var/run/nginx.pid</code> to <code>/opt/nginx/logs/nginx.pid</code> or other path you have defined in your nginx config file.
B. Set your <strong>&ldquo;pid&rdquo;</strong> directive to expected path:</p></blockquote><p>pid /var/run/nginx.pid;</p><blockquote><p>in your nginx config file(such as, /opt/nginx/conf/nginx.conf), and then restart your server.</p></blockquote><p>If the above work are all finished, everything done! You should remember to check if everything runs normally at other days.</p></div><div id=links><a href=https://blog.hackerpie.com/posts/archive/backup-database-and-other-attachments-in-ror/>&#171;&nbsp;Backup database and other attachments in ROR</a>
<a href=https://blog.hackerpie.com/posts/archive/diy-an-interesting-timer-through-terminal-notifier-and-crontab-under-mac-os-x/>DIY an interesting timer through terminal-notifier and crontab under Mac OS X&nbsp;&#187;</a></div></section></body><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/highlight.min.js></script><script>hljs.highlightAll()</script><script>var _hmt=_hmt||[];(function(){var a=document.createElement("script"),b;a.src="https://hm.baidu.com/hm.js?288e2eb770bdfc3ef2b333b7d845fb2a",b=document.getElementsByTagName("script")[0],b.parentNode.insertBefore(a,b)})()</script></html>